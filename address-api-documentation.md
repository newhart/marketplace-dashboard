# Documentation API - Gestion des Adresses Client

Cette documentation d√©crit les endpoints API pour la gestion des adresses des clients dans le syst√®me marketplace.

## Base URL
```
http://votre-domaine.com/api
```

## Authentification
Toutes les routes n√©cessitent une authentification via Sanctum. Incluez le token Bearer dans l'en-t√™te Authorization :
```
Authorization: Bearer {token}
```

---

## üìç **Gestion des Adresses Client**

### `GET /customer/addresses`

R√©cup√®re toutes les adresses de l'utilisateur authentifi√©.

#### Headers
```
Authorization: Bearer {token}
```

#### Param√®tres de requ√™te (optionnels)
| Param√®tre | Type | Description |
|-----------|------|-------------|
| type | string | Filtrer par type : `shipping` ou `billing` |

#### Exemple de requ√™te
```
GET /api/customer/addresses?type=shipping
```

#### R√©ponse de succ√®s (200)
```json
{
    "success": true,
    "data": [
        {
            "id": 1,
            "user_id": 123,
            "type": "shipping",
            "title": "Domicile",
            "first_name": "Jean",
            "last_name": "Dupont",
            "company": null,
            "address_line_1": "123 Rue de la Paix",
            "address_line_2": "Appartement 4B",
            "city": "Antananarivo",
            "state": "Analamanga",
            "postal_code": "101",
            "country": "Madagascar",
            "phone": "+261 34 12 345 67",
            "is_default": true,
            "created_at": "2025-09-20T10:30:00Z",
            "updated_at": "2025-09-20T10:30:00Z",
            "full_name": "Jean Dupont",
            "full_address": "123 Rue de la Paix, Appartement 4B, Antananarivo, Analamanga 101"
        }
    ]
}
```

---

### `POST /customer/addresses`

Cr√©e une nouvelle adresse pour l'utilisateur authentifi√©.

#### Headers
```
Content-Type: application/json
Authorization: Bearer {token}
```

#### Corps de la requ√™te
```json
{
    "type": "shipping",
    "title": "Bureau",
    "first_name": "Jean",
    "last_name": "Dupont",
    "company": "Mon Entreprise",
    "address_line_1": "456 Avenue de l'Ind√©pendance",
    "address_line_2": "Bureau 201",
    "city": "Antananarivo",
    "state": "Analamanga",
    "postal_code": "101",
    "country": "Madagascar",
    "phone": "+261 34 12 345 67",
    "is_default": false
}
```

#### Param√®tres
| Param√®tre | Type | Requis | Description |
|-----------|------|--------|-------------|
| type | string | Oui | Type d'adresse : `shipping` ou `billing` |
| title | string | Non | Titre de l'adresse (ex: "Domicile", "Bureau") |
| first_name | string | Oui | Pr√©nom |
| last_name | string | Oui | Nom de famille |
| company | string | Non | Nom de l'entreprise |
| address_line_1 | string | Oui | Premi√®re ligne d'adresse |
| address_line_2 | string | Non | Deuxi√®me ligne d'adresse |
| city | string | Oui | Ville |
| state | string | Non | Province/√âtat |
| postal_code | string | Oui | Code postal |
| country | string | Non | Pays (par d√©faut: Madagascar) |
| phone | string | Non | Num√©ro de t√©l√©phone |
| is_default | boolean | Non | D√©finir comme adresse par d√©faut |

#### R√©ponse de succ√®s (201)
```json
{
    "success": true,
    "message": "Adresse cr√©√©e avec succ√®s",
    "data": {
        "id": 2,
        "user_id": 123,
        "type": "shipping",
        "title": "Bureau",
        "first_name": "Jean",
        "last_name": "Dupont",
        "company": "Mon Entreprise",
        "address_line_1": "456 Avenue de l'Ind√©pendance",
        "address_line_2": "Bureau 201",
        "city": "Antananarivo",
        "state": "Analamanga",
        "postal_code": "101",
        "country": "Madagascar",
        "phone": "+261 34 12 345 67",
        "is_default": false,
        "created_at": "2025-09-20T11:00:00Z",
        "updated_at": "2025-09-20T11:00:00Z"
    }
}
```

---

### `GET /customer/addresses/{id}`

R√©cup√®re une adresse sp√©cifique de l'utilisateur.

#### Headers
```
Authorization: Bearer {token}
```

#### Param√®tres d'URL
| Param√®tre | Type | Description |
|-----------|------|-------------|
| id | integer | ID de l'adresse |

#### R√©ponse de succ√®s (200)
```json
{
    "success": true,
    "data": {
        "id": 1,
        "user_id": 123,
        "type": "shipping",
        "title": "Domicile",
        "first_name": "Jean",
        "last_name": "Dupont",
        "company": null,
        "address_line_1": "123 Rue de la Paix",
        "address_line_2": "Appartement 4B",
        "city": "Antananarivo",
        "state": "Analamanga",
        "postal_code": "101",
        "country": "Madagascar",
        "phone": "+261 34 12 345 67",
        "is_default": true,
        "created_at": "2025-09-20T10:30:00Z",
        "updated_at": "2025-09-20T10:30:00Z"
    }
}
```

---

### `PUT /customer/addresses/{id}`

Met √† jour une adresse existante.

#### Headers
```
Content-Type: application/json
Authorization: Bearer {token}
```

#### Param√®tres d'URL
| Param√®tre | Type | Description |
|-----------|------|-------------|
| id | integer | ID de l'adresse √† modifier |

#### Corps de la requ√™te
```json
{
    "title": "Nouveau Domicile",
    "address_line_1": "789 Nouvelle Rue",
    "city": "Fianarantsoa",
    "postal_code": "301",
    "is_default": true
}
```

#### R√©ponse de succ√®s (200)
```json
{
    "success": true,
    "message": "Adresse mise √† jour avec succ√®s",
    "data": {
        "id": 1,
        "user_id": 123,
        "type": "shipping",
        "title": "Nouveau Domicile",
        "first_name": "Jean",
        "last_name": "Dupont",
        "company": null,
        "address_line_1": "789 Nouvelle Rue",
        "address_line_2": "Appartement 4B",
        "city": "Fianarantsoa",
        "state": "Analamanga",
        "postal_code": "301",
        "country": "Madagascar",
        "phone": "+261 34 12 345 67",
        "is_default": true,
        "created_at": "2025-09-20T10:30:00Z",
        "updated_at": "2025-09-20T11:30:00Z"
    }
}
```

---

### `DELETE /customer/addresses/{id}`

Supprime une adresse.

#### Headers
```
Authorization: Bearer {token}
```

#### Param√®tres d'URL
| Param√®tre | Type | Description |
|-----------|------|-------------|
| id | integer | ID de l'adresse √† supprimer |

#### R√©ponse de succ√®s (200)
```json
{
    "success": true,
    "message": "Adresse supprim√©e avec succ√®s"
}
```

---

### `PATCH /customer/addresses/{id}/set-default`

D√©finit une adresse comme adresse par d√©faut.

#### Headers
```
Authorization: Bearer {token}
```

#### Param√®tres d'URL
| Param√®tre | Type | Description |
|-----------|------|-------------|
| id | integer | ID de l'adresse √† d√©finir par d√©faut |

#### R√©ponse de succ√®s (200)
```json
{
    "success": true,
    "message": "Adresse d√©finie comme adresse par d√©faut",
    "data": {
        "id": 1,
        "user_id": 123,
        "type": "shipping",
        "title": "Domicile",
        "first_name": "Jean",
        "last_name": "Dupont",
        "company": null,
        "address_line_1": "123 Rue de la Paix",
        "address_line_2": "Appartement 4B",
        "city": "Antananarivo",
        "state": "Analamanga",
        "postal_code": "101",
        "country": "Madagascar",
        "phone": "+261 34 12 345 67",
        "is_default": true,
        "created_at": "2025-09-20T10:30:00Z",
        "updated_at": "2025-09-20T11:45:00Z"
    }
}
```

---

## üìã **Types d'Adresses**

| Type | Description |
|------|-------------|
| `shipping` | Adresse de livraison |
| `billing` | Adresse de facturation |

---

## üîß **Fonctionnalit√©s Sp√©ciales**

### **Adresse par D√©faut**
- Chaque utilisateur peut avoir une adresse par d√©faut par type (`shipping` et `billing`)
- D√©finir une adresse comme par d√©faut d√©sactive automatiquement l'ancienne adresse par d√©faut du m√™me type
- Les adresses par d√©faut sont retourn√©es en premier dans la liste

### **Attributs Calcul√©s**
- `full_name` : Concat√©nation de `first_name` + `last_name`
- `full_address` : Adresse compl√®te format√©e

---

## ‚ö†Ô∏è **Codes d'Erreur**

| Code | Description |
|------|-------------|
| 200 | Succ√®s |
| 201 | Cr√©√© avec succ√®s |
| 401 | Non authentifi√© |
| 404 | Adresse non trouv√©e |
| 422 | Erreurs de validation |
| 500 | Erreur serveur interne |

---

## üß™ **Exemples d'Utilisation**

### JavaScript/Fetch
```javascript
// R√©cup√©rer toutes les adresses de livraison
const getShippingAddresses = async () => {
    const response = await fetch('/api/customer/addresses?type=shipping', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    });
    
    const data = await response.json();
    return data;
};

// Cr√©er une nouvelle adresse
const createAddress = async (addressData) => {
    const response = await fetch('/api/customer/addresses', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(addressData)
    });
    
    const data = await response.json();
    return data;
};

// D√©finir une adresse par d√©faut
const setDefaultAddress = async (addressId) => {
    const response = await fetch(`/api/customer/addresses/${addressId}/set-default`, {
        method: 'PATCH',
        headers: {
            'Authorization': `Bearer ${token}`
        }
    });
    
    const data = await response.json();
    return data;
};
```

### cURL
```bash
# R√©cup√©rer toutes les adresses
curl -X GET http://votre-domaine.com/api/customer/addresses \
  -H "Authorization: Bearer YOUR_TOKEN"

# Cr√©er une nouvelle adresse
curl -X POST http://votre-domaine.com/api/customer/addresses \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "type": "shipping",
    "title": "Domicile",
    "first_name": "Jean",
    "last_name": "Dupont",
    "address_line_1": "123 Rue de la Paix",
    "city": "Antananarivo",
    "postal_code": "101",
    "is_default": true
  }'

# D√©finir une adresse par d√©faut
curl -X PATCH http://votre-domaine.com/api/customer/addresses/1/set-default \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## üîó **Int√©gration avec les Commandes**

Les adresses cr√©√©es via cette API peuvent √™tre utilis√©es lors de la cr√©ation de commandes. Il suffit de r√©f√©rencer l'ID de l'adresse dans la requ√™te de commande :

```json
{
    "items": [...],
    "shipping_address_id": 1,
    "billing_address_id": 2,
    "total_amount": 150.75
}
```

Cette API offre une gestion compl√®te des adresses pour am√©liorer l'exp√©rience utilisateur lors du processus de commande ! üè†üì¶
